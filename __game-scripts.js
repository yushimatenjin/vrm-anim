pc.extend(pc,function(){var t=function(t){this._app=t,this._tweens=[],this._add=[]};t.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var i=0,e=this._tweens.length;i<e;)this._tweens[i].update(t)?i++:(this._tweens.splice(i,1),e--);this._add.length&&(this._tweens=this._tweens.concat(this._add),this._add.length=0)}};var i=function(t,i,e){pc.events.attach(this),this.manager=i,e&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.Linear,this._sv={},this._ev={}},e=function(t){var i;return t instanceof pc.Vec2?i={x:t.x,y:t.y}:t instanceof pc.Vec3?i={x:t.x,y:t.y,z:t.z}:t instanceof pc.Vec4?i={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Quat?i={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Color?(i={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(i.a=t.a)):i=t,i};i.prototype={to:function(t,i,n,s,r,h){return this._properties=e(t),this.duration=i,n&&(this.easing=n),s&&this.delay(s),r&&this.repeat(r),h&&this.yoyo(h),this},from:function(t,i,n,s,r,h){return this._properties=e(t),this.duration=i,n&&(this.easing=n),s&&this.delay(s),r&&this.repeat(r),h&&this.yoyo(h),this._from=!0,this},rotate:function(t,i,n,s,r,h){return this._properties=e(t),this.duration=i,n&&(this.easing=n),s&&this.delay(s),r&&this.repeat(r),h&&this.yoyo(h),this._slerp=!0,this},start:function(){var t,i,e,n;if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this._properties[t],this._ev[t]=this.target[t]);this._slerp&&(this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,n=void 0!==this._properties.z?this._properties.z:this.target.z,this._fromQuat.setFromEulerAngles(i,e,n))}else{for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this.target[t],this._ev[t]=this._properties[t]);this._slerp&&(this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,n=void 0!==this._properties.z?this._properties.z:this.target.z,this._toQuat.setFromEulerAngles(i,e,n))}return this._currentDelay=this._delay,this.manager.add(this),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,i){return this._count=0,this._numRepeats=t,this._repeatDelay=i||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time=this.time-this._currentDelay,this.pending=!1}var i=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(i=this.duration-this.time,this.time=0):(i=this.time-this.duration,this.time=this.duration));var e,n,s=this.time/this.duration,r=this.easing(s);for(var h in this._properties)this._properties.hasOwnProperty(h)&&(e=this._sv[h],n=this._ev[h],this.target[h]=e+(n-e)*r);if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,r),this.entity&&(this.entity._dirtifyLocal(),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var a=this._repeat(i);return a?this.fire("loop"):(this.fire("complete",i),this.entity&&this.entity.off("destroy",this.stop,this),this._chained&&this._chained.start()),a}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var i in this._properties){var e=this._sv[i];this._sv[i]=this._ev[i],this._ev[i]=e}this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var n=function(t){return 1-s(1-t)},s=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375};return{TweenManager:t,Tween:i,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){return t*t*(2.70158*t-1.70158)},BackOut:function(t){return--t*t*(2.70158*t+1.70158)+1},BackInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},BounceIn:n,BounceOut:s,BounceInOut:function(t){return t<.5?.5*n(2*t):.5*s(2*t-1)+.5},ElasticIn:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},ElasticOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4)*.5+1)}}}()),function(){pc.Application.prototype.addTweenManager=function(){this._tweenManager=new pc.TweenManager(this),this.on("update",function(t){this._tweenManager.update(t)})},pc.Application.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,i){var e=this._app.tween(t);return e.entity=this,this.once("destroy",e.stop,e),i&&i.element&&(e.element=i.element),e};var t=pc.Application.getApplication();t&&t.addTweenManager()}();// manager.js
/*jshint esversion: 2015, asi: true, laxbreak: true*/
const Manager = pc.createScript('manager');

let number = 0;
Manager.prototype.initialize = function() {
    this.vrmManager()

};

Manager.prototype.vrmManager = function(){
    this.app.on("game:model:change", interval => {
        number = number + interval;
        if(number === 5 ){
            number = 0;
        }else if(number === -1){
            number = 4;
        }else{
            
        }
        this.app.fire("game:model:load", number)
    })
}


// vrmloader.js
/*jshint esversion: 2015, asi: true, laxbreak: true*/
const VrmLoader = pc.createScript('vrmloader');
VrmLoader.attributes.add("vrm", {"type": "asset", array:true})
VrmLoader.attributes.add("number", {"type": "number"})
VrmLoader.attributes.add("toon", {"type": "boolean", default: true})
VrmLoader.attributes.add("anim", {"type": "asset"})

VrmLoader.prototype.loadAsset = function(asset,position,rotate) {
    const glb = asset.resource;
    const app = this.app
    const {x,y,z} = position
    loadGlb(glb, app.graphicsDevice,  (err, res) => {
        const asset = new pc.Asset('gltf', 'model', {
            url: ''
        });    
        asset.resource = res.model;
        const animationClips  = res.animations;
        console.log(res)
        asset.loaded = true;
        app.assets.add(asset);
        this.entity.removeComponent("model");
        this.entity.addComponent('model', {
            asset: asset,
            castShadows: true,
            receiveShadows: true,
            castShadowsLightmap: true
        });

        if(this.entity.script.toon){
            this.entity.script.toon.enabled = true
        }

           
        let runAnim
        this.app.assets.loadFromUrl(location.href.includes("launch.playcanvas.com") ? "https://launch.playcanvas.com/" +  this.anim.getFileUrl(): this.anim.getFileUrl() , "animation",  (err, asset) => {
            runAnim = asset;
            this.entity.addComponent("animation", {
                        assets: [runAnim],
                        speed: 1,
                        loop: true
            });  
            
       
        });
        
        
        
        this.app.fire("game:text:change", `Model: VRM`)

        this.app.fire(`loaded:model:${this.number}`)
    });

}
VrmLoader.prototype.initialize = function() {
    this.app.on("game:model:load", (number) => {
       const onAssetLoad = (asset) => {
        this.app.fire("game:text:change", "Loading...") 
           this.loadAsset(this.vrm[number], {x: 0, y: 0, z: 0}) 
       }
       if(this.vrm[number].loaded){
        this.app.fire("game:text:change", "Loading...") 

        this.loadAsset(this.vrm[number], {x: 0, y: 0, z: 0}) 
       }else{
        this.vrm[number].on('load', onAssetLoad);
        this.app.assets.load(this.vrm[number]);
        this.app.fire("game:text:change", "Loading...") 
       }
    })
    this.app.fire("game:model:load", number)
};


var TouchInput=pc.createScript("touchInput");TouchInput.attributes.add("orbitSensitivity",{type:"number",default:.4,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),TouchInput.attributes.add("distanceSensitivity",{type:"number",default:.2,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),TouchInput.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera,this.lastTouchPoint=new pc.Vec2,this.lastPinchMidPoint=new pc.Vec2,this.lastPinchDistance=0,this.orbitCamera&&this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.on("destroy",function(){this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)}))},TouchInput.prototype.getPinchDistance=function(t,i){var o=t.x-i.x,n=t.y-i.y;return Math.sqrt(o*o+n*n)},TouchInput.prototype.calcMidPoint=function(t,i,o){o.set(i.x-t.x,i.y-t.y),o.scale(.5),o.x+=t.x,o.y+=t.y},TouchInput.prototype.onTouchStartEndCancel=function(t){var i=t.touches;1==i.length?this.lastTouchPoint.set(i[0].x,i[0].y):2==i.length&&(this.lastPinchDistance=this.getPinchDistance(i[0],i[1]),this.calcMidPoint(i[0],i[1],this.lastPinchMidPoint))},TouchInput.fromWorldPoint=new pc.Vec3,TouchInput.toWorldPoint=new pc.Vec3,TouchInput.worldDiff=new pc.Vec3,TouchInput.prototype.pan=function(t){var i=TouchInput.fromWorldPoint,o=TouchInput.toWorldPoint,n=TouchInput.worldDiff,h=this.entity.camera,c=this.orbitCamera.distance;h.screenToWorld(t.x,t.y,c,i),h.screenToWorld(this.lastPinchMidPoint.x,this.lastPinchMidPoint.y,c,o),n.sub2(o,i),this.orbitCamera.pivotPoint.add(n)},TouchInput.pinchMidPoint=new pc.Vec2,TouchInput.prototype.onTouchMove=function(t){var i=TouchInput.pinchMidPoint,o=t.touches;if(1==o.length){var n=o[0];this.orbitCamera.pitch-=(n.y-this.lastTouchPoint.y)*this.orbitSensitivity,this.orbitCamera.yaw-=(n.x-this.lastTouchPoint.x)*this.orbitSensitivity,this.lastTouchPoint.set(n.x,n.y)}else if(2==o.length){var h=this.getPinchDistance(o[0],o[1]),c=h-this.lastPinchDistance;this.lastPinchDistance=h,this.orbitCamera.distance-=c*this.distanceSensitivity*.1*(.1*this.orbitCamera.distance),this.calcMidPoint(o[0],o[1],i),this.pan(i),this.lastPinchMidPoint.copy(i)}};var OrbitCamera=pc.createScript("orbitCamera");OrbitCamera.attributes.add("distanceMax",{type:"number",default:0,title:"Distance Max",description:"Setting this at 0 will give an infinite distance limit"}),OrbitCamera.attributes.add("distanceMin",{type:"number",default:0,title:"Distance Min"}),OrbitCamera.attributes.add("pitchAngleMax",{type:"number",default:90,title:"Pitch Angle Max (degrees)"}),OrbitCamera.attributes.add("pitchAngleMin",{type:"number",default:-90,title:"Pitch Angle Min (degrees)"}),OrbitCamera.attributes.add("inertiaFactor",{type:"number",default:0,title:"Inertia Factor",description:"Higher value means that the camera will continue moving after the user has stopped dragging. 0 is fully responsive."}),OrbitCamera.attributes.add("focusEntity",{type:"entity",title:"Focus Entity",description:"Entity for the camera to focus on. If blank, then the camera will use the whole scene"}),OrbitCamera.attributes.add("frameOnStart",{type:"boolean",default:!0,title:"Frame on Start",description:'Frames the entity or scene at the start of the application."'}),Object.defineProperty(OrbitCamera.prototype,"distance",{get:function(){return this._targetDistance},set:function(t){this._targetDistance=this._clampDistance(t)}}),Object.defineProperty(OrbitCamera.prototype,"pitch",{get:function(){return this._targetPitch},set:function(t){this._targetPitch=this._clampPitchAngle(t)}}),Object.defineProperty(OrbitCamera.prototype,"yaw",{get:function(){return this._targetYaw},set:function(t){this._targetYaw=t;var i=(this._targetYaw-this._yaw)%360;this._targetYaw=i>180?this._yaw-(360-i):i<-180?this._yaw+(360+i):this._yaw+i}}),Object.defineProperty(OrbitCamera.prototype,"pivotPoint",{get:function(){return this._pivotPoint},set:function(t){this._pivotPoint.copy(t)}}),OrbitCamera.prototype.focus=function(t){this._buildAabb(t,0);var i=this._modelsAabb.halfExtents,e=Math.max(i.x,Math.max(i.y,i.z));e/=Math.tan(.5*this.entity.camera.fov*pc.math.DEG_TO_RAD),e*=2,this.distance=e,this._removeInertia(),this._pivotPoint.copy(this._modelsAabb.center)},OrbitCamera.distanceBetween=new pc.Vec3,OrbitCamera.prototype.resetAndLookAtPoint=function(t,i){this.pivotPoint.copy(i),this.entity.setPosition(t),this.entity.lookAt(i);var e=OrbitCamera.distanceBetween;e.sub2(i,t),this.distance=e.length(),this.pivotPoint.copy(i);var a=this.entity.getRotation();this.yaw=this._calcYaw(a),this.pitch=this._calcPitch(a,this.yaw),this._removeInertia(),this._updatePosition()},OrbitCamera.prototype.resetAndLookAtEntity=function(t,i){this._buildAabb(i,0),this.resetAndLookAtPoint(t,this._modelsAabb.center)},OrbitCamera.prototype.reset=function(t,i,e){this.pitch=i,this.yaw=t,this.distance=e,this._removeInertia()},OrbitCamera.prototype.initialize=function(){var t=this,i=function(){t._checkAspectRatio()};window.addEventListener("resize",i,!1),this._checkAspectRatio(),this._modelsAabb=new pc.BoundingBox,this._buildAabb(this.focusEntity||this.app.root,0),this.entity.lookAt(this._modelsAabb.center),this._pivotPoint=new pc.Vec3,this._pivotPoint.copy(this._modelsAabb.center);var e=this.entity.getRotation();if(this._yaw=this._calcYaw(e),this._pitch=this._clampPitchAngle(this._calcPitch(e,this._yaw)),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0),this._distance=0,this._targetYaw=this._yaw,this._targetPitch=this._pitch,this.frameOnStart)this.focus(this.focusEntity||this.app.root);else{var a=new pc.Vec3;a.sub2(this.entity.getPosition(),this._pivotPoint),this._distance=this._clampDistance(a.length())}this._targetDistance=this._distance,this.on("attr:distanceMin",function(t,i){this._targetDistance=this._clampDistance(this._distance)}),this.on("attr:distanceMax",function(t,i){this._targetDistance=this._clampDistance(this._distance)}),this.on("attr:pitchAngleMin",function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)}),this.on("attr:pitchAngleMax",function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)}),this.on("attr:focusEntity",function(t,i){this.frameOnStart?this.focus(t||this.app.root):this.resetAndLookAtEntity(this.entity.getPosition(),t||this.app.root)}),this.on("attr:frameOnStart",function(t,i){t&&this.focus(this.focusEntity||this.app.root)}),this.on("destroy",function(){window.removeEventListener("resize",i,!1)})},OrbitCamera.prototype.update=function(t){var i=0===this.inertiaFactor?1:Math.min(t/this.inertiaFactor,1);this._distance=pc.math.lerp(this._distance,this._targetDistance,i),this._yaw=pc.math.lerp(this._yaw,this._targetYaw,i),this._pitch=pc.math.lerp(this._pitch,this._targetPitch,i),this._updatePosition()},OrbitCamera.prototype._updatePosition=function(){this.entity.setLocalPosition(0,0,0),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0);var t=this.entity.getPosition();t.copy(this.entity.forward),t.scale(-this._distance),t.add(this.pivotPoint),this.entity.setPosition(t)},OrbitCamera.prototype._removeInertia=function(){this._yaw=this._targetYaw,this._pitch=this._targetPitch,this._distance=this._targetDistance},OrbitCamera.prototype._checkAspectRatio=function(){var t=this.app.graphicsDevice.height,i=this.app.graphicsDevice.width;this.entity.camera.horizontalFov=t>i},OrbitCamera.prototype._buildAabb=function(t,i){var e=0;if(t.model){var a=t.model.meshInstances;for(e=0;e<a.length;e++)0===i?this._modelsAabb.copy(a[e].aabb):this._modelsAabb.add(a[e].aabb),i+=1}for(e=0;e<t.children.length;++e)i+=this._buildAabb(t.children[e],i);return i},OrbitCamera.prototype._calcYaw=function(t){var i=new pc.Vec3;return t.transformVector(pc.Vec3.FORWARD,i),Math.atan2(-i.x,-i.z)*pc.math.RAD_TO_DEG},OrbitCamera.prototype._clampDistance=function(t){return this.distanceMax>0?pc.math.clamp(t,this.distanceMin,this.distanceMax):Math.max(t,this.distanceMin)},OrbitCamera.prototype._clampPitchAngle=function(t){return pc.math.clamp(t,-this.pitchAngleMax,-this.pitchAngleMin)},OrbitCamera.quatWithoutYaw=new pc.Quat,OrbitCamera.yawOffset=new pc.Quat,OrbitCamera.prototype._calcPitch=function(t,i){var e=OrbitCamera.quatWithoutYaw,a=OrbitCamera.yawOffset;a.setFromEulerAngles(0,-i,0),e.mul2(a,t);var s=new pc.Vec3;return e.transformVector(pc.Vec3.FORWARD,s),Math.atan2(s.y,-s.z)*pc.math.RAD_TO_DEG};var MouseInput=pc.createScript("mouseInput");MouseInput.attributes.add("orbitSensitivity",{type:"number",default:.3,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),MouseInput.attributes.add("distanceSensitivity",{type:"number",default:.15,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),MouseInput.prototype.initialize=function(){if(this.orbitCamera=this.entity.script.orbitCamera,this.orbitCamera){var t=this,o=function(o){t.onMouseOut(o)};this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.addEventListener("mouseout",o,!1),this.on("destroy",function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.off(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.removeEventListener("mouseout",o,!1)})}this.app.mouse.disableContextMenu(),this.lookButtonDown=!1,this.panButtonDown=!1,this.lastPoint=new pc.Vec2},MouseInput.fromWorldPoint=new pc.Vec3,MouseInput.toWorldPoint=new pc.Vec3,MouseInput.worldDiff=new pc.Vec3,MouseInput.prototype.pan=function(t){var o=MouseInput.fromWorldPoint,e=MouseInput.toWorldPoint,i=MouseInput.worldDiff,s=this.entity.camera,n=this.orbitCamera.distance;s.screenToWorld(t.x,t.y,n,o),s.screenToWorld(this.lastPoint.x,this.lastPoint.y,n,e),i.sub2(e,o),this.orbitCamera.pivotPoint.add(i)},MouseInput.prototype.onMouseDown=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!0;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!0}},MouseInput.prototype.onMouseUp=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!1;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!1}},MouseInput.prototype.onMouseMove=function(t){pc.app.mouse;this.lookButtonDown?(this.orbitCamera.pitch-=t.dy*this.orbitSensitivity,this.orbitCamera.yaw-=t.dx*this.orbitSensitivity):this.panButtonDown&&this.pan(t),this.lastPoint.set(t.x,t.y)},MouseInput.prototype.onMouseWheel=function(t){this.orbitCamera.distance-=t.wheel*this.distanceSensitivity*(.1*this.orbitCamera.distance),t.event.preventDefault()},MouseInput.prototype.onMouseOut=function(t){this.lookButtonDown=!1,this.panButtonDown=!1};var KeyboardInput=pc.createScript("keyboardInput");KeyboardInput.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera},KeyboardInput.prototype.postInitialize=function(){this.orbitCamera&&(this.startDistance=this.orbitCamera.distance,this.startYaw=this.orbitCamera.yaw,this.startPitch=this.orbitCamera.pitch,this.startPivotPosition=this.orbitCamera.pivotPoint.clone())},KeyboardInput.prototype.update=function(t){this.orbitCamera&&this.app.keyboard.wasPressed(pc.KEY_SPACE)&&(this.orbitCamera.reset(this.startYaw,this.startPitch,this.startDistance),this.orbitCamera.pivotPoint=this.startPivotPosition)};Object.assign(window,function(){var e={NUM:0,VEC:1,QUAT:2},t=function(e,t,i){this.init(e,t,i)};t.prototype.init=function(t,i,n){if(this.type=t||e.NUM,this.time=i||0,n)this.value=n;else switch(t){case e.NUM:this.value=0;break;case e.VEC:this.value=new pc.Vec3;break;case e.QUAT:this.value=new pc.Quat}return this},t.prototype.copy=function(e){if(!e)return this;var i=t._cloneValue(e.value);return this.init(e.type,e.time,i),(e.inTangent||0===e.inTangent)&&(this.inTangent=t._cloneValue(e.inTangent)),(e.outTangent||0===e.outTangent)&&(this.outTangent=t._cloneValue(e.outTangent)),this},t.prototype.clone=function(){var e=t._cloneValue(this.value),i=new t(this.type,this.time,e);return(this.inTangent||0===this.inTangent)&&(i.inTangent=t._cloneValue(this.inTangent)),(this.outTangent||0===this.outTangent)&&(i.outTangent=t._cloneValue(this.outTangent)),i},t._cloneValue=function(e){return e instanceof pc.Vec3||e instanceof pc.Quat?e.clone():void 0!==e&&"function"==typeof e.clone?e.clone():e},t.sum=function(i,n){if(!i||!n||i.type!=n.type)return null;var s=new t(i.type);switch(i.type){case e.NUM:s.value=i.value+n.value;break;case e.VEC:s.value.add2(i.value,n.value);break;case e.QUAT:s.value.x=i.value.x+n.value.x,s.value.y=i.value.y+n.value.y,s.value.z=i.value.z+n.value.z,s.value.w=i.value.w+n.value.w}return s},t.minus=function(i,n){if(!i||!n||i.type!=n.type)return null;var s=new t(i.type);switch(i.type){case e.NUM:s.value=i.value-n.value;break;case e.VEC:s.value.sub2(i.value,n.value);break;case e.QUAT:s.value.x=i.value.x-n.value.x,s.value.y=i.value.y-n.value.y,s.value.z=i.value.z-n.value.z,s.value.w=i.value.w-n.value.w}return s},t.mul=function(i,n){if(!i)return null;var s=new t;switch(s.copy(i),i.type){case e.NUM:s.value*=n;break;case e.VEC:s.value.scale(n);break;case e.QUAT:s.value.x*=n,s.value.y*=n,s.value.z*=n,s.value.w*=n}return s},t.div=function(e,i){return 0===i?null:t.mul(e,1/i)},t.linearBlend=function(i,n,s,a){if(!i||!n||i.type!==n.type)return null;var r;if(r=a||new t(i.type),0===s)return r.copy(i),r;if(1===s)return r.copy(n),r;switch(i.type){case e.NUM:r.value=(1-s)*i.value+s*n.value;break;case e.VEC:r.value.lerp(i.value,n.value,s);break;case e.QUAT:r.value.slerp(i.value,n.value,s)}return r},t.linearBlendValue=function(e,t,i){var n;return"number"==typeof e&&"number"==typeof t?(1-i)*e+i*t:e instanceof pc.Vec3&&t instanceof pc.Vec3||e instanceof pc.Vec2&&t instanceof pc.Vec2||e instanceof pc.Vec4&&t instanceof pc.Vec4?((n=e.clone()).lerp(e,t,i),n):e instanceof pc.Quat&&t instanceof pc.Quat?((n=e.clone()).slerp(e,t,i),n):null};var i=function(e,t,i){this.targetNode=e,this.targetPath=t,this.targetProp=i};i.prototype.toString=function(){var e="";return this.targetNode&&(e+=this.targetNode.name),this.targetPath&&(e+="_"+this.targetPath),this.targetProp&&(e+="_"+this.targetProp),e},i.prototype.copy=function(e){return e&&(this.targetNode=e.targetNode,this.targetPath=e.targetPath,this.targetProp=e.targetProp),this},i.prototype.clone=function(){return new i(this.targetNode,this.targetPath,this.targetProp)},i.prototype.blendToTarget=function(e,i){if(!(void 0===e||i>1||i<=0))if("localPosition"===this.targetPath&&this.vScale instanceof pc.Vec3&&(e instanceof pc.Vec3?(e.x*=this.vScale.x,e.y*=this.vScale.y,e.z*=this.vScale.z):"number"==typeof e&&"number"==typeof this.vScale[this.targetProp]&&(e*=this.vScale[this.targetProp])),1!==i){if(this.targetNode&&void 0!==this.targetNode[this.targetPath]){var n;if(this.targetProp&&this.targetProp in this.targetNode[this.targetPath]?(n=t.linearBlendValue(this.targetNode[this.targetPath][this.targetProp],e,i),this.targetNode[this.targetPath][this.targetProp]=n):(n=t.linearBlendValue(this.targetNode[this.targetPath],e,i),this.targetNode[this.targetPath]=n),"localEulerAngles"==this.targetPath){var s=new pc.Vec3;"x"===this.targetProp||"y"===this.targetProp||"z"===this.targetProp?s[this.targetProp]=n:s=n,this.targetNode.setLocalEulerAngles(s)}"function"==typeof this.targetNode._dirtifyLocal&&this.targetNode._dirtifyLocal()}}else this.updateToTarget(e)},i.prototype.updateToTarget=function(e){if(void 0!==e){if("localPosition"===this.targetPath&&this.vScale instanceof pc.Vec3&&(e instanceof pc.Vec3?(e.x*=this.vScale.x,e.y*=this.vScale.y,e.z*=this.vScale.z):"number"==typeof e&&"number"==typeof this.vScale[this.targetProp]&&(e*=this.vScale[this.targetProp])),this.targetNode&&void 0!==this.targetNode[this.targetPath]){if(this.targetProp&&this.targetProp in this.targetNode[this.targetPath]?this.targetNode[this.targetPath][this.targetProp]=e:this.targetNode[this.targetPath]=e,"localEulerAngles"==this.targetPath){var t=new pc.Vec3;"x"===this.targetProp||"y"===this.targetProp||"z"===this.targetProp?t[this.targetProp]=e:t=e,this.targetNode.setLocalEulerAngles(t)}"function"==typeof this.targetNode._dirtifyLocal&&this.targetNode._dirtifyLocal()}if(this.targetNode&&"weights"===this.targetPath&&this.targetNode.model)for(var i=this.targetNode.model.meshInstances,n=0;n<i.length;n++){var s=i[n].morphInstance;s&&s.setWeight(this.targetProp,e)}}},i.constructTargetNodes=function(e,t,n){if(e){var s=t||new pc.Vec3(1,1,1),a=new i(e);e.localScale&&(a.vScale=new pc.Vec3(e.localScale.x*s.x,e.localScale.y*s.y,e.localScale.z*s.z)),n[a.targetNode.name]=a;for(var r=0;r<e.children.length;r++)i.constructTargetNodes(e.children[r],a.vScale,n)}},i.getLocalScale=function(e,t){if(t.set(1,1,1),e)for(;e;)e.localScale&&t.mul(e.localScale),e=e.parent};var n={LINEAR:0,STEP:1,CUBIC:2,CUBICSPLINE_GLTF:3},s=function(){s.count++,this.name="curve"+s.count.toString(),this.type=n.LINEAR,this.keyableType=e.NUM,this.tension=.5,this.animTargets=[],this.duration=0,this.animKeys=[]};s.count=0,Object.defineProperty(s.prototype,"isPlaying",{get:function(){return!!this.session&&this.session.isPlaying},set:function(e){this.session&&(this.session.isPlaying=e)}}),Object.defineProperty(s.prototype,"loop",{get:function(){return!!this.session&&this.session.loop},set:function(e){this.session&&(this.session.loop=e)}}),Object.defineProperty(s.prototype,"bySpeed",{get:function(){return this.session?this.session.bySpeed:0},set:function(e){this.session&&(this.session.bySpeed=e)}}),s.prototype.copy=function(e){var i;for(this.name=e.name,this.type=e.type,this.keyableType=e.keyableType,this.tension=e.tension,this.duration=e.duration,this.animTargets=[],i=0;i<e.animTargets.length;i++)this.animTargets.push(e.animTargets[i].clone());for(this.animKeys=[],i=0;i<e.animKeys.length;i++){var n=new t;n.copy(e.animKeys[i]),this.animKeys.push(n)}return this},s.prototype.clone=function(){return(new s).copy(this)},s.prototype.addTarget=function(e,t,n){var s=new i(e,t,n);this.animTargets.push(s)},s.prototype.setTarget=function(e,t,i){this.animTargets=[],this.addTarget(e,t,i)},s.prototype.clearTargets=function(){this.animTargets=[]},s.prototype.resetSession=function(){this.session&&(this.session.playable=this,this.session.animTargets=this.getAnimTargets(),this.session.isPlaying=!0,this.session.begTime=0,this.session.endTime=this.duration,this.session.curTime=0,this.session.bySpeed=1,this.session.loop=!0)},s.prototype.blendToTarget=function(e,t){this.session&&this.session.blendToTarget(e,t)},s.prototype.updateToTarget=function(e){this.session&&this.session.updateToTarget(e)},s.prototype.getAnimTargets=function(){var e={};return e[this.name]=this.animTargets,e},s.prototype.on=function(e,t,i,n,s){return this.session&&this.session.on(e,t,i,n,s),this},s.prototype.off=function(e,t,i){return this.session&&this.session.off(e,t,i),this},s.prototype.removeAllEvents=function(){return this.session&&this.session.removeAllEvents(),this},s.prototype.fadeIn=function(e){this.session||(this.session=new h(this)),this.session.fadeIn(e,this)},s.prototype.fadeOut=function(e){this.session&&this.session.fadeOut(e)},s.prototype.play=function(){this.session||(this.session=new h(this)),this.session.play(this)},s.prototype.resume=function(){this.session&&this.session.resume()},s.prototype.stop=function(){this.session&&this.session.stop()},s.prototype.pause=function(){this.session&&this.session.pause()},s.prototype.showAt=function(e,t,i,n,s){this.session&&this.session.showAt(e,t,i,n,s)},s.prototype.setAnimKeys=function(e){this.animKeys=e},s.prototype.insertKey=function(e,i,n){if(this.keyableType==e){for(var s=0;s<this.animKeys.length&&this.animKeys[s].time<i;)s++;if(s<this.animKeys.length&&this.animKeys[s].time==i)this.animKeys[s].value=n;else{var a=new t(e,i,n);if(s>=this.animKeys.length)return this.animKeys.push(a),void(this.duration=i);this.animKeys.splice(s,0,a)}}},s.prototype.insertKeyable=function(e){if(e&&this.keyableType==e.type){for(var t=e.time,i=0;i<this.animKeys.length&&this.animKeys[i].time<t;)i++;if(!(i<this.animKeys.length&&this.animKeys[i].time==t))return i>=this.animKeys.length?(this.animKeys.push(e),void(this.duration=t)):void this.animKeys.splice(i,0,e);this.animKeys[i]=e}},s.prototype.removeKey=function(e){e<=this.animKeys.length&&(e==this.animKeys.length-1&&(this.duration=e-1>=0?this.animKeys[e-1].time:0),this.animKeys.splice(e,1))},s.prototype.removeAllKeys=function(){this.animKeys=[],this.duration=0},s.prototype.shiftKeyTime=function(e){for(var t=0;t<this.animKeys.length;t++)this.animKeys[t].time+=e},s.prototype.getSubCurve=function(e,i){var n,a=new s;for(a.type=this.type,a.name=this.name+"_sub",a.keyableType=this.keyableType,a.animTargets=this.animTargets,a.tension=this.tension,a.animTargets=[],n=0;n<this.animTargets.length;n++)a.animTargets.push(this.animTargets[n].clone());var r=-1;for(n=0;n<this.animKeys.length;n++)if(this.animKeys[n].time>=e&&this.animKeys[n].time<=i){r<0&&(r=this.animKeys[n].time);var o=(new t).copy(this.animKeys[n]);o.time-=r,a.animKeys.push(o)}return a.duration=-1===r?0:i-r,a},s.prototype.evalLINEAR=function(e){if(!this.animKeys||0===this.animKeys.length)return null;for(var i,n,s=new t,a=0;a<this.animKeys.length;a++){if(this.animKeys[a].time===e)return s.copy(this.animKeys[a]),s;if(this.animKeys[a].time>e){n=this.animKeys[a];break}i=this.animKeys[a]}if(!i||!n)return s.copy(i||n),s.time=e,s;var r=(e-i.time)/(n.time-i.time);return(s=t.linearBlend(i,n,r)).time=e,s},s.prototype.evalLINEAR_cache=function(e,i,n){if(!this.animKeys||0===this.animKeys.length)return null;var s,a,r=n,o=0;i&&(o=i);for(var h=o,l=0;l<this.animKeys.length;l++){if(h=(o+l)%this.animKeys.length,this.animKeys[h].time===e)return r.copy(this.animKeys[h]),r._cacheKeyIdx=h,r;if(0===h&&this.animKeys[h].time>e){s=null,a=this.animKeys[h];break}if(h==this.animKeys.length-1&&this.animKeys[h].time<e){s=this.animKeys[h],a=null;break}if(this.animKeys[h].time>e&&(h-1<0||this.animKeys[h-1].time<e)){s=this.animKeys[h-1],a=this.animKeys[h];break}}if(!s||!a)return r.copy(s||a),r.time=e,r._cacheKeyIdx=h,r;var u=(e-s.time)/(a.time-s.time);return(r=t.linearBlend(s,a,u,r)).time=e,r._cacheKeyIdx=h,r},s.prototype.evalSTEP=function(e){if(!this.animKeys||0===this.animKeys.length)return null;for(var i=this.animKeys[0],n=1;n<this.animKeys.length&&this.animKeys[n].time<=e;n++)i=this.animKeys[n];var s=new t;return s.copy(i),s.time=e,s},s.prototype.evalSTEP_cache=function(e,t,i){if(!this.animKeys||0===this.animKeys.length)return null;var n=0;t&&(n=t);for(var s=n,a=this.animKeys[s],r=1;r<this.animKeys.length;r++){if(0===(s=(n+r)%this.animKeys.length)&&this.animKeys[s].time>e){a=this.animKeys[s];break}if(s===this.animKeys.length-1&&this.animKeys[s].time<=e){a=this.animKeys[s];break}if(this.animKeys[s].time<=e&&(s+1>=this.animKeys.length||this.animKeys[s+1].time>e)){a=this.animKeys[s];break}}var o=i;return o.copy(a),o.time=e,o._cacheKeyIdx=s,o},s.prototype.evalCUBIC=function(i){if(!this.animKeys||0===this.animKeys.length)return null;for(var n,a,r,o,h=new t,l=0;l<this.animKeys.length;l++){if(this.animKeys[l].time===i)return h.copy(this.animKeys[l]),h;if(this.animKeys[l].time>i){r=this.animKeys[l],l+1<this.animKeys.length&&(o=this.animKeys[l+1]);break}a=this.animKeys[l],l-1>=0&&(n=this.animKeys[l-1])}return a&&r?a.type==e.NUM||a.type==e.VEC?((h=s.cubicCardinal(n,a,r,o,i,this.tension)).time=i,h):null:(h.copy(a||r),h.time=i,h)},s.prototype.evalCUBIC_cache=function(t,i,n){if(!this.animKeys||0===this.animKeys.length)return null;var a=0;i&&(a=i);for(var r,o,h,l,u=a,c=n,p=0;p<this.animKeys.length;p++){if(u=(a+p)%this.animKeys.length,this.animKeys[u].time===t)return c.copy(this.animKeys[u]),c._cacheKeyIdx=u,c;if(0===u&&this.animKeys[u].time>t){r=null,o=null,h=this.animKeys[u],u+1<this.animKeys.length&&(l=this.animKeys[u+1]);break}if(u==this.animKeys.length-1&&this.animKeys[u].time<t){u-1>0&&(r=this.animKeys[u-1]),o=this.animKeys[u],h=null,l=null;break}if(this.animKeys[u].time>t&&(u-1<0||this.animKeys[u-1].time<t)){u-2>0&&(r=this.animKeys[u-2]),o=this.animKeys[u-1],h=this.animKeys[u],u+1<this.animKeys.length&&(l=this.animKeys[u+1]);break}}return o&&h?o.type==e.NUM||o.type==e.VEC?((c=s.cubicCardinal(r,o,h,l,t,this.tension)).time=t,c._cacheKeyIdx=u,c):null:(c.copy(o||h),c.time=t,c._cacheKeyIdx=u,c)},s.prototype.evalCUBICSPLINE_GLTF=function(i){if(!this.animKeys||0===this.animKeys.length)return null;for(var n,a,r=new t,o=0;o<this.animKeys.length;o++){if(this.animKeys[o].time===i)return r.copy(this.animKeys[o]),r;if(this.animKeys[o].time>i){a=this.animKeys[o];break}n=this.animKeys[o]}if(!n||!a)return r.copy(n||a),r.time=i,r;var h=(i-n.time)/(a.time-n.time),l=a.time-n.time;return this.keyableType===e.NUM?r.value=s.cubicHermite(l*n.outTangent,n.value,l*a.inTangent,a.value,h):this.keyableType===e.VEC?(r.value.x=s.cubicHermite(l*n.outTangent.x,n.value.x,l*a.inTangent.x,a.value.x,h),r.value.y=s.cubicHermite(l*n.outTangent.y,n.value.y,l*a.inTangent.y,a.value.y,h),r.value.z=s.cubicHermite(l*n.outTangent.z,n.value.z,l*a.inTangent.z,a.value.z,h)):this.keyableType===e.QUAT&&(r.value.w=s.cubicHermite(l*n.outTangent.w,n.value.w,l*a.inTangent.w,a.value.w,h),r.value.x=s.cubicHermite(l*n.outTangent.x,n.value.x,l*a.inTangent.x,a.value.x,h),r.value.y=s.cubicHermite(l*n.outTangent.y,n.value.y,l*a.inTangent.y,a.value.y,h),r.value.z=s.cubicHermite(l*n.outTangent.z,n.value.z,l*a.inTangent.z,a.value.z,h),r.value.normalize()),r.time=i,r},s.prototype.evalCUBICSPLINE_GLTF_cache=function(t,i,n){if(!this.animKeys||0===this.animKeys.length)return null;var a=0;i&&(a=i);for(var r,o,h=a,l=n,u=0;u<this.animKeys.length;u++){if(h=(a+u)%this.animKeys.length,this.animKeys[h].time===t)return l.copy(this.animKeys[h]),l._cacheKeyIdx=h,l;if(0===h&&this.animKeys[h].time>t){r=null,o=this.animKeys[h];break}if(h===this.animKeys.length-1&&this.animKeys[h].time<t){r=this.animKeys[h],o=null;break}if(this.animKeys[h].time>t&&(h-1<0||this.animKeys[h-1].time<t)){r=this.animKeys[h-1],o=this.animKeys[h];break}}if(!r||!o)return l.copy(r||o),l.time=t,l._cacheKeyIdx=h,l;var c=(t-r.time)/(o.time-r.time),p=o.time-r.time;return this.keyableType===e.NUM?l.value=s.cubicHermite(p*r.outTangent,r.value,p*o.inTangent,o.value,c):this.keyableType===e.VEC?(l.value.x=s.cubicHermite(p*r.outTangent.x,r.value.x,p*o.inTangent.x,o.value.x,c),l.value.y=s.cubicHermite(p*r.outTangent.y,r.value.y,p*o.inTangent.y,o.value.y,c),l.value.z=s.cubicHermite(p*r.outTangent.z,r.value.z,p*o.inTangent.z,o.value.z,c)):this.keyableType===e.QUAT&&(l.value.w=s.cubicHermite(p*r.outTangent.w,r.value.w,p*o.inTangent.w,o.value.w,c),l.value.x=s.cubicHermite(p*r.outTangent.x,r.value.x,p*o.inTangent.x,o.value.x,c),l.value.y=s.cubicHermite(p*r.outTangent.y,r.value.y,p*o.inTangent.y,o.value.y,c),l.value.z=s.cubicHermite(p*r.outTangent.z,r.value.z,p*o.inTangent.z,o.value.z,c),l.value.normalize()),l.time=t,l._cacheKeyIdx=h,l},s.prototype.eval_cache=function(t,i,s){if(!this.animKeys||0===this.animKeys.length)return null;switch(this.type){case n.LINEAR:return this.evalLINEAR_cache(t,i,s);case n.STEP:return this.evalSTEP_cache(t,i,s);case n.CUBIC:return this.keyableType==e.QUAT?this.evalLINEAR_cache(t,i,s):this.evalCUBIC_cache(t,i,s);case n.CUBICSPLINE_GLTF:return this.evalCUBICSPLINE_GLTF_cache(t,i,s)}return null},s.prototype.eval=function(t){if(!this.animKeys||0===this.animKeys.length)return null;switch(this.type){case n.LINEAR:return this.evalLINEAR(t);case n.STEP:return this.evalSTEP(t);case n.CUBIC:return this.keyableType==e.QUAT?this.evalLINEAR(t):this.evalCUBIC(t);case n.CUBICSPLINE_GLTF:return this.evalCUBICSPLINE_GLTF(t)}return null},s.cubicHermite=function(e,t,i,n,s){var a=s*s,r=a*s;return t*(2*r-3*a+1)+n*(-2*r+3*a)+e*(r-2*a+s)+i*(r-a)},s.cubicCardinal=function(i,n,a,r,o,h,l){var u,c;if(!n||!a||n.type!=a.type)return null;if(n.type!=e.NUM&&n.type!=e.VEC)return null;var p,m=(o-n.time)/(a.time-n.time);p=l||new t(n.type);var y=h*(a.time-n.time);if(n.type===e.NUM&&(u=y*(a.value-n.value)/(a.time-n.time),i&&(u=2*y*(a.value-i.value)/(a.time-i.time)),c=y*(a.value-n.value)/(a.time-n.time),r&&(c=2*y*(r.value-n.value)/(r.time-n.time)),p.value=s.cubicHermite(u,n.value,c,a.value,m)),n.type===e.VEC){p.value=n.value.clone();for(var v=["x","y","z","w"],f=0;f<v.length;f++){var g=v[f];void 0!==p.value[g]&&(u=y*(a.value[g]-n.value[g])/(a.time-n.time),i&&(u=2*y*(a.value[g]-i.value[g])/(a.time-i.time)),c=y*(a.value[g]-n.value[g])/(a.time-n.time),r&&(c=2*y*(r.value[g]-n.value[g])/(r.time-n.time)),p.value[g]=s.cubicHermite(u,n.value[g],c,a.value[g],m))}}return p};var a=function(){this.curveKeyable={},this.curveNames=[]};a.prototype.copy=function(e){if(!e)return this;this.curveKeyable={},this.curveNames=[];for(var i=0;i<e.curveNames.length;i++){var n=e.curveNames[i];this.curveKeyable[n]=(new t).copy(e.curveKeyable[n]),this.curveNames.push(n)}return this},a.prototype.clone=function(){return(new a).copy(this)},a.linearBlend=function(e,i,n){if(!e||!i)return null;if(0===n)return e;if(1===n)return i;var s=new a;s.copy(e);for(var r=0;r<i.curveNames.length;r++){var o=i.curveNames[r];if(e.curveKeyable[o]&&i.curveKeyable[o]){var h=t.linearBlend(e.curveKeyable[o],i.curveKeyable[o],n);s.curveKeyable[o]=h}else e.curveKeyable[o]?s.curveKeyable[o]=e.curveKeyable[o]:i.curveKeyable[o]&&(s.curveKeyable[o]=i.curveKeyable[o])}return s},a.linearBlendExceptStep=function(e,i,s,r){if(!e||!i)return null;if(0===s)return e;if(1===s)return i;var o=new a;o.copy(e);for(var h=0;h<i.curveNames.length;h++){var l=i.curveNames[h];if(e.curveKeyable[l]&&i.curveKeyable[l])if(r[l]&&r[l].type===n.STEP)o.curveKeyable[l]=s>.5?i.curveKeyable[l]:e.curveKeyable[l];else{var u=t.linearBlend(e.curveKeyable[l],i.curveKeyable[l],s);o.curveKeyable[l]=u}else e.curveKeyable[l]?o.curveKeyable[l]=e.curveKeyable[l]:i.curveKeyable[l]&&(o.curveKeyable[l]=i.curveKeyable[l])}return o};var r=function(e){r.count++,this.name="clip"+r.count.toString(),this.duration=0,this.animCurvesMap={},this.animCurves=[],this.root=null,e&&(this.root=e,this.constructFromRoot(e)),this.session=new h(this)};r.count=0,Object.defineProperty(r.prototype,"isPlaying",{get:function(){return this.session.isPlaying},set:function(e){this.session.isPlaying=e}}),Object.defineProperty(r.prototype,"loop",{get:function(){return this.session.loop},set:function(e){this.session.loop=e}}),Object.defineProperty(r.prototype,"bySpeed",{get:function(){return this.session.bySpeed},set:function(e){this.session.bySpeed=e}}),r.prototype.copy=function(e){this.name=e.name,this.duration=e.duration,this.animCurves.length=0,this.animCurvesMap={};for(var t=0,i=e.animCurves.length;t<i;t++){var n=e.animCurves[t];this.addCurve(n.clone())}return this},r.prototype.clone=function(){return(new r).copy(this)},r.prototype.updateDuration=function(){this.duration=0;for(var e=0,t=this.animCurves.length;e<t;e++){var i=this.animCurves[e];this.duration=Math.max(this.duration,i.duration)}},r.prototype.showAt=function(e,t,i,n,s){this.session.showAt(e,t,i,n,s)},r.prototype.blendToTarget=function(e,t){this.session.blendToTarget(e,t)},r.prototype.updateToTarget=function(e){this.session.updateToTarget(e)},r.prototype.getAnimTargets=function(){for(var e={},t=0,i=this.animCurves.length;t<i;t++){var n=this.animCurves[t],s=n.getAnimTargets();e[n.name]=s[n.name]}return e},r.prototype.resetSession=function(){this.session.playable=this,this.session.animTargets=this.getAnimTargets(),this.session.isPlaying=!0,this.session.begTime=0,this.session.endTime=this.duration,this.session.curTime=0,this.session.bySpeed=1,this.session.loop=!0},r.prototype.play=function(){this.session.play(this)},r.prototype.stop=function(){this.session.stop()},r.prototype.pause=function(){this.session.pause()},r.prototype.resume=function(){this.session.resume()},r.prototype.fadeIn=function(e){this.session.fadeIn(e,this)},r.prototype.fadeOut=function(e){this.session.fadeOut(e)},r.prototype.fadeTo=function(e,t){this.session.fadeTo(e,t)},r.prototype.addCurve=function(e){e&&e.name&&(this.animCurves.push(e),this.animCurvesMap[e.name]=e,e.duration>this.duration&&(this.duration=e.duration))},r.prototype.removeCurve=function(e){if(e){var t=this.animCurvesMap[e];if(t){var i=this.animCurves.indexOf(t);-1!==i&&this.animCurves.splice(i,1),delete this.animCurvesMap[e],this.updateDuration()}}},r.prototype.removeAllCurves=function(){this.animCurves.length=0,this.animCurvesMap={},this.duration=0},r.prototype.on=function(e,t,i,n,s){return this.session&&this.session.on(e,t,i,n,s),this},r.prototype.off=function(e,t,i){return this.session&&this.session.off(e,t,i),this},r.prototype.removeAllEvents=function(){return this.session&&this.session.removeAllEvents(),this},r.prototype.getSubClip=function(e,t){var i=new r;i.name=this.name+"_sub",i.root=this.root;for(var n=0,s=this.animCurves.length;n<s;n++){var a=this.animCurves[n].getSubCurve(e,t);i.addCurve(a)}return i},r.prototype.eval_cache=function(e,i,n){if(!n){var s=this.eval();return s._cacheKeyIdx=i,s}var a=n;a.time=e;for(var r=0,o=this.animCurves.length;r<o;r++){var h,l,u=this.animCurves[r];i&&(h=i[u.name]),l=n?n.curveKeyable[u.name]:new t(u.keyableType);var c=u.eval_cache(e,h,l);i&&c&&(i[u.name]=c._cacheKeyIdx),a.curveKeyable[u.name]=c}return a._cacheKeyIdx=i,a},r.prototype.eval=function(e){var t=new a;t.time=e;for(var i=0,n=this.animCurves.length;i<n;i++){var s=this.animCurves[i],r=s.eval(e);t.curveKeyable[s.name]=r,t.curveNames.push(s.name)}return t},r.prototype.constructFromRoot=function(t){if(t){var i=new s;i.keyableType=e.VEC,i.name=t.name+".localScale",i.setTarget(t,"localScale"),this.addCurve(i);var n=new s;n.keyableType=e.VEC,n.name=t.name+".localPosition",n.setTarget(t,"localPosition"),this.addCurve(n);var a=new s;a.name=t.name+".localRotation.quat",a.keyableType=e.QUAT,a.setTarget(t,"localRotation"),this.addCurve(a);for(var r=0;r<t.children.length;r++)t.children[r]&&this.constructFromRoot(t.children[r])}},r.prototype.transferToRoot=function(e){var t=new pc.Vec3,n={};i.constructTargetNodes(e,null,n);for(var s=0,a=this.animCurves.length;s<a;s++){var r=this.animCurves[s];if(0!==r.animTargets.length){"model"===r.animTargets[0].targetNode&&(r.animTargets[0].targetNode=e);var o=r.animTargets[0],h=n[o.targetNode.name];h&&(i.getLocalScale(o.targetNode,t),o.targetNode=h.targetNode,h.vScale&&(o.vScale=t.clone(),h.vScale.x&&(o.vScale.x/=h.vScale.x),h.vScale.y&&(o.vScale.y/=h.vScale.y),h.vScale.z&&(o.vScale.z/=h.vScale.z)))}}},r.prototype.updateCurveNameFromTarget=function(){for(var e=0,t=this.animCurves.length;e<t;e++){var i=this.animCurves[e];if(i.animTargets&&!(i.animTargets.length<1)){var n=i.name,s=i.animTargets[0].toString();n!=s&&(i.name=s,delete this.animCurvesMap[n],this.animCurvesMap[s]=i)}}},r.prototype.removeEmptyCurves=function(){for(var e=0,t=this.animCurves.length;e<t;e++){var i=this.animCurves[e];i&&i.animKeys&&0!==i.animKeys.length||this.removeCurve(i.name)}},r.prototype.setInterpolationType=function(e){for(var t=0,i=this.animCurves.length;t<i;t++){var n=this.animCurves[t];n&&(n.type=e)}};var o=function(e,t,i,n,s){this.name=e,this.triggerTime=t,this.fnCallback=i,this.context=n||this,this.parameter=s,this.triggered=!1};o.prototype.invoke=function(){this.fnCallback&&(this.fnCallback.call(this.context,this.parameter),this.triggered=!0)};var h=function AnimationSession(e,t){this._cacheKeyIdx=void 0,this._cacheValue=void 0,this._cacheBlendValues={},this.begTime=-1,this.endTime=-1,this.curTime=0,this.accTime=0,this.bySpeed=1,this.isPlaying=!1,this.loop=!1,this.fadeBegTime=-1,this.fadeEndTime=-1,this.fadeTime=-1,this.fadeDir=0,this.fadeSpeed=1,this.playable=null,this.animTargets={},e&&(this.playable=e,this.allocateCache(),t||(this.animTargets=e.getAnimTargets())),t&&(this.animTargets=t),this.animEvents=[],this.blendables={},this.blendWeights={};var i=this;this.onTimer=function(e){if(i.curTime+=i.bySpeed*e,i.accTime+=i.bySpeed*e,!i.isPlaying||!i.loop&&(i.curTime<i.begTime||i.curTime>i.endTime))return i.invokeByTime(i.curTime),i.stop(),void i.invokeByName("stop");var t=i.endTime-i.begTime;if(i.curTime>i.endTime){i.invokeByTime(i.curTime),i.curTime-=t;for(var n=0;n<i.animEvents.length;n++)i.animEvents[n].triggered=!1}if(i.curTime<i.begTime&&(i.curTime+=t),i.fadeDir&&(i.fadeTime+=e,i.fadeTime>=i.fadeEndTime))if(1===i.fadeDir)i.fadeDir=0,i.fadeBegTime=-1,i.fadeEndTime=-1,i.fadeTime=-1;else if(-1===i.fadeDir)return void i.stop();i.showAt(i.curTime,i.fadeDir,i.fadeBegTime,i.fadeEndTime,i.fadeTime),i.invokeByTime(i.curTime)}};h._allocatePlayableCache=function(e){if(!e)return null;if(e instanceof s)return new t(e.keyableType);if(e instanceof r){for(var i=new a,n=0,o=e.animCurves.length;n<o;n++){var h=e.animCurves[n].name;i.curveKeyable[h]=new t(e.animCurves[n].keyableType),i.curveNames.push(h)}return i}return null},h.prototype.allocateCache=function(){this.playable&&(this.playable instanceof s?this._cacheKeyIdx=0:this.playable instanceof r&&(this._cacheKeyIdx={}),this._cacheValue=h._allocatePlayableCache(this.playable))},h.prototype.clone=function(){var e,t,i=new h;for(t in i.begTime=this.begTime,i.endTime=this.endTime,i.curTime=this.curTime,i.accTime=this.accTime,i.speed=this.speed,i.loop=this.loop,i.isPlaying=this.isPlaying,i.fadeBegTime=this.fadeBegTime,i.fadeEndTime=this.fadeEndTime,i.fadeTime=this.fadeTime,i.fadeDir=this.fadeDir,i.fadeSpeed=this.fadeSpeed,i.playable=this.playable,i.allocateCache(),i.animTargets={},this.animTargets)if(this.animTargets.hasOwnProperty(t)){var n=this.animTargets[t],s=[];for(e=0;e<n.length;e++)s.push(n[e].clone());i.animTargets[t]=s}for(i.animEvents=[],e=0;e<this.animEvents.length;e++)i.animEvents.push(this.animEvents[e].clone());for(t in i.blendables={},this.blendables)this.blendables.hasOwnProperty(t)&&(i.blendables[t]=this.blendables[t],i._cacheBlendValues[t]=h._allocatePlayableCache(this.blendables[t]));for(t in i.blendWeights={},this.blendWeights)this.blendWeights.hasOwnProperty(t)&&(i.blendWeights[t]=this.blendWeights[t]);return i},h.prototype.setBlend=function(i,n,s){if(i instanceof r)return s&&""!==s||(s="__default__"),this.blendables[s]=i,this._cacheBlendValues[s]=h._allocatePlayableCache(i),void(this.blendWeights[s]=n);var a;"number"==typeof i?a=e.NUM:i instanceof pc.Vec3?a=e.VEC:i instanceof pc.Quat&&(a=e.QUAT),s&&""!==s&&void 0!==a&&(this.blendWeights[s]=n,this.blendables[s]=new t(a,0,i),this._cacheBlendValues[s]=null)},h.prototype.unsetBlend=function(e){e&&""!==e||(e="__default__"),this.blendables[e]&&(delete this.blendables[e],delete this._cacheBlendValues[e],delete this.blendWeights[e])},h.prototype.on=function(e,t,i,n,s){if(e&&i){for(var a=new o(e,t,i,n,s),r=0;r<this.animEvents.length&&!(this.animEvents[r].triggerTime>t);r++);r>=this.animEvents.length?this.animEvents.push(a):this.animEvents.splice(r,0,a)}},h.prototype.off=function(e,t,i){for(var n=0;n<this.animEvents.length;n++){var s=this.animEvents[n];if(s){if(s.name===e&&s.fnCallback===i)break;if(s.triggerTime===t&&s.fnCallback===i)break}}n<this.animEvents.length&&this.animEvents.splice(n,1)},h.prototype.removeAllEvents=function(){this.animEvents=[]},h.prototype.invokeByName=function(e){for(var t=0;t<this.animEvents.length;t++)this.animEvents[t]&&this.animEvents[t].name===e&&this.animEvents[t].invoke()},h.prototype.invokeByTime=function(e){for(var t=0;t<this.animEvents.length;t++)if(this.animEvents[t]){if(this.animEvents[t].triggerTime>e)break;this.animEvents[t].triggered||this.animEvents[t].invoke()}},h.prototype.blendToTarget=function(e,i){var o,h,l,u,c,p=0,m=1,y=2;if(!(!e||i>1||i<=0))if(1!==i){if(this.playable instanceof s&&e instanceof t){if(l=this.playable.name,!(u=this.animTargets[l]))return;for(c=p,this.playable.type===n.STEP&&this.fadeDir&&(c=-1==this.fadeDir&&i<=.5||1==this.fadeDir&&i>.5?m:y),h=0;h<u.length;h++)c===p?u[h].blendToTarget(e.value,i):c===m&&u[h].updateToTarget(e.value)}else if(this.playable instanceof r&&e instanceof a)for(o=0;o<e.curveNames.length;o++)if((l=e.curveNames[o])&&(c=p,this.playable.animCurvesMap[l]&&this.playable.animCurvesMap[l].type===n.STEP&&this.fadeDir&&(c=-1==this.fadeDir&&i<=.5||1==this.fadeDir&&i>.5?m:y),u=this.animTargets[l]))for(h=0;h<u.length;h++)c===p?u[h].blendToTarget(e.curveKeyable[l].value,i):c===m&&u[h].updateToTarget(e.value)}else this.updateToTarget(e)},h.prototype.updateToTarget=function(e){var i,n,o,h;if(e)if(this.playable instanceof s&&e instanceof t){if(o=this.playable.name,!(h=this.animTargets[o]))return;for(n=0;n<h.length;n++)h[n].updateToTarget(e.value)}else if(this.playable instanceof r&&e instanceof a)for(i=0;i<e.curveNames.length;i++)if((o=e.curveNames[i])&&(h=this.animTargets[o]))for(n=0;n<h.length;n++)e.curveKeyable[o]&&h[n].updateToTarget(e.curveKeyable[o].value)},h.prototype.showAt=function(e,i,n,s,o){var h,l=this.playable.eval_cache(e,this._cacheKeyIdx,this._cacheValue);for(var u in l&&(this._cacheKeyIdx=l._cacheKeyIdx),this.blendables)if(this.blendables.hasOwnProperty(u)){h=this.blendWeights[u];var c=this.blendables[u];if(c&&c instanceof r&&"number"==typeof h){var p=c.eval_cache(this.accTime%c.duration,null,this._cacheBlendValues[u]);l=a.linearBlendExceptStep(l,p,h,this.playable.animCurvesMap)}}for(var m in this.blendables)if(this.blendables.hasOwnProperty(m)){h=this.blendWeights[m];var y=this.blendables[m];if(y&&l.curveKeyable[m]&&!(y instanceof r)){var v=t.linearBlend(l.curveKeyable[m],y,h);l.curveKeyable[m]=v}}0===i||o<n||o>s?this.updateToTarget(l):(h=(o-n)/(s-n),-1===i&&(h=1-h),this.fadeSpeed<1&&-1===i&&(h*=this.fadeSpeed),this.blendToTarget(l,h))},h.prototype.play=function(e,t){var i;if(e&&(this.playable=e,this.allocateCache()),!(this.playable instanceof r||this.playable instanceof s))return this;if(this.isPlaying)return this;for(this.begTime=0,this.endTime=this.playable.duration,this.curTime=0,this.accTime=0,this.isPlaying=!0,e&&this!==e.session&&(this.bySpeed=e.bySpeed,this.loop=e.loop),!t&&e&&"function"==typeof e.getAnimTargets?this.animTargets=e.getAnimTargets():t&&(this.animTargets=t),i=0;i<this.animEvents.length;i++)this.animEvents[i].triggered=!1;return pc.Application.getApplication().on("update",this.onTimer),this.showAt(this.curTime,this.fadeDir,this.fadeBegTime,this.fadeEndTime,this.fadeTime),this},h.prototype.stop=function(){return pc.Application.getApplication().off("update",this.onTimer),this.curTime=0,this.isPlaying=!1,this.fadeBegTime=-1,this.fadeEndTime=-1,this.fadeTime=-1,this.fadeDir=0,this.fadeSpeed=1,this},h.prototype.pause=function(){return pc.Application.getApplication().off("update",this.onTimer),this.isPlaying=!1,this},h.prototype.resume=function(){this.isPlaying||(this.isPlaying=!0,pc.Application.getApplication().on("update",this.onTimer))},h.prototype.fadeOut=function(e){if(0===this.fadeDir)this.fadeSpeed=1;else{if(1!==this.fadeDir)return;this.fadeSpeed=(this.fadeTime-this.fadeBegTime)/(this.fadeEndTime-this.fadeBegTime)}"number"!=typeof e&&(e=0),this.fadeBegTime=this.curTime,this.fadeTime=this.fadeBegTime,this.fadeEndTime=this.fadeBegTime+e,this.fadeDir=-1},h.prototype.fadeIn=function(e,t){this.isPlaying&&this.stop(),this.fadeSpeed=0,this.curTime=0,"number"!=typeof e&&(e=0),this.fadeBegTime=this.curTime,this.fadeTime=this.fadeBegTime,this.fadeEndTime=this.fadeBegTime+e,this.fadeDir=1,t&&(this.playable=t,this.allocateCache()),this.play(t)},h.prototype.fadeTo=function(e,t){this.fadeOut(t);var i=new h;return i.fadeIn(t,e),i},h.prototype.fadeToSelf=function(e){var t=this.clone();pc.Application.getApplication().off("update",this.onTimer),t.fadeOut(e),this.stop(),this.fadeIn(e)};var l=function(){this.name="",this.animClipsMap={},this.animClips=[],this.curClip="",this.animSessions={}};return l.prototype.clipCount=function(){return this.animClips.length},l.prototype.getCurrentClip=function(){return this.animClipsMap[this.curClip]},l.prototype.clipAt=function(e){return this.animClips.length<=e?null:this.animClips[e]},l.prototype.addClip=function(e){e&&e.name&&(this.animClips.push(e),this.animClipsMap[e.name]=e)},l.prototype.removeClip=function(e){var t=this.animClipsMap[e];if(t){var i=this.animClips.indexOf(t);-1!==i&&this.animClips.splice(i,1),delete this.animClipsMap[e]}this.curClip===e&&(this.curClip="")},l.prototype.playClip=function(e){var t=this.animClipsMap[e];t&&(this.curClip=e,t.play())},l.prototype.stopClip=function(){var e=this.animSessions[this.curClip];e&&e.stop();var t=this.animClipsMap[this.curClip];t&&t.stop(),this.curClip=""},l.prototype.crossFadeToClip=function(e,t){var i=this.animClipsMap[this.curClip],n=this.animClipsMap[e];i&&n?(i.fadeOut(t),n.fadeIn(t),this.curClip=e):i?(i.fadeOut(t),this.curClip=""):n&&(n.fadeIn(t),this.curClip=e)},l.prototype.setBlend=function(e,t,i){var n=this.getCurrentClip();n&&n.session&&n.session.setBlend(e,t,i)},l.prototype.unsetBlend=function(e){var t=this.getCurrentClip();t&&t.session&&t.session.unsetBlend(e)},l.prototype.getCurrentSession=function(){return this.animSessions[this.curClip]},l.prototype.playSession=function(e){var t=this.animSessions[e];t&&(t.play(),this.curClip=e)},l.prototype.stopSession=function(){var e=this.animSessions[this.curClip];e&&e.stop();var t=this.animClipsMap[this.curClip];t&&t.stop(),this.curClip=""},l.prototype.crossFadeToSession=function(e,t){var i=this.animSessions[this.curClip],n=this.animSessions[e];i&&this.animSessions[e]?(i.fadeOut(t),n.fadeIn(t),this.curClip=e):i?(i.fadeOut(t),this.curClip=""):n&&(n.fadeIn(t),this.curClip=e)},l.prototype.setBlendSession=function(e,t,i){var n=this.animSessions[this.curClip];n&&n.setBlend(e,t,i)},l.prototype.unsetBlendSession=function(e){var t=this.animSessions[this.curClip];t&&t.unsetBlend(e)},l.prototype.playSubstring=function(e){for(var t=this.animClips.length,i=0;i<t;i++){var n=this.animClips[i];n.isPlaying&&n.pause(),-1!==n.name.indexOf(e)&&n.play()}},l.prototype.pauseAll=function(){for(var e=this.animClips.length,t=0;t<e;t++){var i=this.animClips[t];i.isPlaying&&i.pause()}},{AnimationKeyableType:e,AnimationKeyable:t,AnimationTarget:i,AnimationCurveType:n,AnimationCurve:s,AnimationClipSnapshot:a,AnimationClip:r,AnimationEvent:o,AnimationSession:h,AnimationComponent:l}}());Object.assign(window,function(){function nearestPow2(e){return Math.pow(2,Math.round(Math.log(e)/Math.log(2)))}function isPowerOf2(e){return e&&0==(e&e-1)}function getFilter(e){var r=pc.FILTER_LINEAR;switch(e){case 9728:r=pc.FILTER_NEAREST;break;case 9729:r=pc.FILTER_LINEAR;break;case 9984:r=pc.FILTER_NEAREST_MIPMAP_NEAREST;break;case 9985:r=pc.FILTER_LINEAR_MIPMAP_NEAREST;break;case 9986:r=pc.FILTER_NEAREST_MIPMAP_LINEAR;break;case 9987:r=pc.FILTER_LINEAR_MIPMAP_LINEAR}return r}function getWrap(e){var r=pc.ADDRESS_REPEAT;switch(e){case 33071:r=pc.ADDRESS_CLAMP_TO_EDGE;break;case 33648:r=pc.ADDRESS_MIRRORED_REPEAT;break;case 10497:r=pc.ADDRESS_REPEAT}return r}function isDataURI(e){return/^data:.*,.*$/i.test(e)}function getAccessorData(e,r,s){var t=e.bufferViews[r.bufferView],a=s[t.buffer],n=(r.hasOwnProperty("byteOffset")?r.byteOffset:0)+(t.hasOwnProperty("byteOffset")?t.byteOffset:0),o=r.count*function getAccessorTypeSize(e){var r=3;switch(e){case"SCALAR":r=1;break;case"VEC2":r=2;break;case"VEC3":r=3;break;case"VEC4":case"MAT2":r=4;break;case"MAT3":r=9;break;case"MAT4":r=16}return r}(r.type),i=null;switch(r.componentType){case 5120:i=new Int8Array(a,n,o);break;case 5121:i=new Uint8Array(a,n,o);break;case 5122:i=new Int16Array(a,n,o);break;case 5123:i=new Uint16Array(a,n,o);break;case 5125:i=new Uint32Array(a,n,o);break;case 5126:i=new Float32Array(a,n,o)}return i}function translateAnimation(e,r){var s=new AnimationClip;s.loop=!0,e.hasOwnProperty("name")&&(s.name=e.name);var t=r.gltf;return e.channels.forEach(function(a){var n,o,i,c,p,f,l,u,d=e.samplers[a.sampler],h=getAccessorData(t,t.accessors[d.input],r.buffers),w=getAccessorData(t,t.accessors[d.output],r.buffers),O=a.target,y=O.path,T=r.nodes[O.node];if("weights"===y){var m=w.length/h.length;for(l=0;l<m;l++){for(p=new AnimationCurve,f=AnimationKeyableType.NUM,p.keyableType=f,p.addTarget("model",y,l),"CUBIC"===d.interpolation?p.type=AnimationCurveType.CUBIC:"STEP"===d.interpolation&&(p.type=AnimationCurveType.STEP),u=0;u<h.length;u++)n=h[u],o=w[m*u+l],p.insertKey(f,n,o);s.addCurve(p)}}else{f=AnimationKeyableType.NUM;var E=y;switch(y){case"translation":f=AnimationKeyableType.VEC,E="localPosition";break;case"scale":f=AnimationKeyableType.VEC,E="localScale";break;case"rotation":f=AnimationKeyableType.QUAT,E="localRotation"}(p=new AnimationCurve).keyableType=f,p.setTarget(T,E),"CUBIC"===d.interpolation?p.type=AnimationCurveType.CUBIC:"STEP"===d.interpolation?p.type=AnimationCurveType.STEP:"CUBICSPLINE"===d.interpolation&&(p.type=AnimationCurveType.CUBICSPLINE_GLTF);var P,M=[];if("CUBICSPLINE"===d.interpolation)for(l=0;l<h.length;l++)n=h[l],"translation"===y||"scale"===y?(i=new pc.Vec3(w[9*l+0],w[9*l+1],w[9*l+2]),o=new pc.Vec3(w[9*l+3],w[9*l+4],w[9*l+5]),c=new pc.Vec3(w[9*l+6],w[9*l+7],w[9*l+8])):"rotation"===y?(i=new pc.Quat(w[12*l+0],w[12*l+1],w[12*l+2],w[12*l+3]),o=new pc.Quat(w[12*l+4],w[12*l+5],w[12*l+6],w[12*l+7]),c=new pc.Quat(w[12*l+8],w[12*l+9],w[12*l+10],w[12*l+11])):(i=w[3*l],o=w[3*l+1],c=w[3*l+2]),(P=new AnimationKeyable(f,n,o)).inTangent=i,P.outTangent=c,M.push(P);else for(l=0;l<h.length;l++)n=h[l],o="translation"===y||"scale"===y?new pc.Vec3(w[3*l+0],w[3*l+1],w[3*l+2]):"rotation"===y?new pc.Quat(w[4*l+0],w[4*l+1],w[4*l+2],w[4*l+3]):w[l],P=new AnimationKeyable(f,n,o),M.push(P);p.animKeys=M,p.duration=n,s.addCurve(p)}}),e.hasOwnProperty("extras")&&r.processAnimationExtras&&r.processAnimationExtras(s,e.extras),s}function translateImage(e,r,s){var t=new Image,a=function(){t.removeEventListener("load",a,!1);var e=r.gltf,n=r.images.indexOf(t);e.textures.forEach(function(e,s){if(e.hasOwnProperty("source")&&e.source===n){var a=r.textures[s];if(isPowerOf2(t.width)&&isPowerOf2(t.width)||a.addressU!==pc.ADDRESS_REPEAT&&a.addressU!==pc.ADDRESS_MIRRORED_REPEAT&&a.addressV!==pc.ADDRESS_REPEAT&&a.addressV!==pc.ADDRESS_MIRRORED_REPEAT&&a.minFilter!==pc.FILTER_LINEAR_MIPMAP_LINEAR&&a.minFilter!==pc.FILTER_NEAREST_MIPMAP_LINEAR&&a.minFilter!==pc.FILTER_LINEAR_MIPMAP_NEAREST&&a.minFilter!==pc.FILTER_NEAREST_MIPMAP_NEAREST)a.setSource(t);else{var o=new Image;o.addEventListener("load",function(){a.setSource(o)}),o.src=function resampleImage(e){var r=e.width,s=e.height,t=nearestPow2(r),a=nearestPow2(s),n=document.createElement("canvas");return n.width=t,n.height=a,n.getContext("2d").drawImage(e,0,0,r,s,0,0,t,a),n.toDataURL()}(t)}}}),r.imagesLoaded++,r.imagesLoaded===e.images.length&&s()};if(t.addEventListener("load",a,!1),e.hasOwnProperty("uri")&&(isDataURI(e.uri)?t.src=e.uri:r.processUri?r.processUri(e.uri,function(e){t.crossOrigin="anonymous",t.src=e}):(t.crossOrigin="anonymous",t.src=r.basePath+e.uri)),e.hasOwnProperty("bufferView")){var n=r.gltf,o=r.buffers,i=n.bufferViews[e.bufferView],c=o[i.buffer],p=i.hasOwnProperty("byteOffset")?i.byteOffset:0,f=c.slice(p,p+i.byteLength),l=new Blob([f],{type:e.mimeType});t.src=URL.createObjectURL(l)}return t}var e=["#ifdef MAPFLOAT","uniform float material_shininess;","#endif","","#ifdef MAPTEXTURE","uniform sampler2D texture_glossMap;","#endif","","void getGlossiness() {","    dGlossiness = 1.0;","","#ifdef MAPFLOAT","    dGlossiness *= material_shininess;","#endif","","#ifdef MAPTEXTURE","    dGlossiness *= texture2D(texture_glossMap, $UV).$CH;","#endif","","#ifdef MAPVERTEX","    dGlossiness *= saturate(vVertexColor.$VC);","#endif","","    dGlossiness = 1.0 - dGlossiness;","","    dGlossiness += 0.0000001;","}"].join("\n"),r=["#ifdef MAPCOLOR","uniform vec3 material_specular;","#endif","","#ifdef MAPTEXTURE","uniform sampler2D texture_specularMap;","#endif","","void getSpecularity() {","    dSpecularity = vec3(1.0);","","    #ifdef MAPCOLOR","        dSpecularity *= material_specular;","    #endif","","    #ifdef MAPTEXTURE","        vec3 srgb = texture2D(texture_specularMap, $UV).$CH;","        dSpecularity *= vec3(pow(srgb.r, 2.2), pow(srgb.g, 2.2), pow(srgb.b, 2.2));","    #endif","","    #ifdef MAPVERTEX","        dSpecularity *= saturate(vVertexColor.$VC);","    #endif","}"].join("\n");function translateMaterial(s,t){var a,n,o=new pc.StandardMaterial;if(o.occludeSpecular=!0,o.diffuseTint=!0,o.diffuseVertexColor=!0,o.specularTint=!0,o.specularVertexColor=!0,s.hasOwnProperty("name")&&(o.name=s.name),s.hasOwnProperty("extensions")&&s.extensions.hasOwnProperty("KHR_materials_unlit")&&(o.useLighting=!1),s.hasOwnProperty("extensions")&&s.extensions.hasOwnProperty("KHR_materials_pbrSpecularGlossiness")){var i=s.extensions.KHR_materials_pbrSpecularGlossiness;if(i.hasOwnProperty("diffuseFactor")?(a=i.diffuseFactor,o.diffuse.set(Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)),o.opacity=null!=a[3]?a[3]:1):(o.diffuse.set(1,1,1),o.opacity=1),i.hasOwnProperty("diffuseTexture")){var c=i.diffuseTexture;if(n=t.textures[c.index],o.diffuseMap=n,o.diffuseMapChannel="rgb",o.opacityMap=n,o.opacityMapChannel="a",c.hasOwnProperty("texCoord")&&(o.diffuseMapUv=c.texCoord,o.opacityMapUv=c.texCoord),c.hasOwnProperty("extensions")&&c.extensions.hasOwnProperty("KHR_texture_transform")){var p=c.extensions.KHR_texture_transform;p.hasOwnProperty("scale")&&(o.diffuseMapTiling=new pc.Vec2(p.scale[0],p.scale[1]),o.opacityMapTiling=new pc.Vec2(p.scale[0],p.scale[1])),p.hasOwnProperty("offset")&&(o.diffuseMapOffset=new pc.Vec2(p.offset[0],p.offset[1]),o.opacityMapOffset=new pc.Vec2(p.offset[0],p.offset[1]))}}if(o.useMetalness=!1,i.hasOwnProperty("specularFactor")?(a=i.specularFactor,o.specular.set(Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2))):o.specular.set(1,1,1),i.hasOwnProperty("glossinessFactor")?o.shininess=100*i.glossinessFactor:o.shininess=100,i.hasOwnProperty("specularGlossinessTexture")){var f=i.specularGlossinessTexture;if(o.specularMap=t.textures[f.index],o.specularMapChannel="rgb",o.glossMap=t.textures[f.index],o.glossMapChannel="a",f.hasOwnProperty("texCoord")&&(o.glossMapUv=f.texCoord,o.metalnessMapUv=f.texCoord),f.hasOwnProperty("extensions")&&f.extensions.hasOwnProperty("KHR_texture_transform")){var l=f.extensions.KHR_texture_transform;l.hasOwnProperty("scale")&&(o.glossMapTiling=new pc.Vec2(l.scale[0],l.scale[1]),o.metalnessMapTiling=new pc.Vec2(l.scale[0],l.scale[1])),l.hasOwnProperty("offset")&&(o.glossMapOffset=new pc.Vec2(l.offset[0],l.offset[1]),o.metalnessMapOffset=new pc.Vec2(l.offset[0],l.offset[1]))}}o.chunks.specularPS=r}else if(s.hasOwnProperty("pbrMetallicRoughness")){var u=s.pbrMetallicRoughness;if(u.hasOwnProperty("baseColorFactor")?(a=u.baseColorFactor,o.diffuse.set(Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)),o.opacity=a[3]):(o.diffuse.set(1,1,1),o.opacity=1),u.hasOwnProperty("baseColorTexture")){var d=u.baseColorTexture;if(n=t.textures[d.index],o.diffuseMap=n,o.diffuseMapChannel="rgb",o.opacityMap=n,o.opacityMapChannel="a",d.hasOwnProperty("texCoord")&&(o.diffuseMapUv=d.texCoord,o.opacityMapUv=d.texCoord),d.hasOwnProperty("extensions")&&d.extensions.hasOwnProperty("KHR_texture_transform")){var h=d.extensions.KHR_texture_transform;h.hasOwnProperty("scale")&&(o.diffuseMapTiling=new pc.Vec2(h.scale[0],h.scale[1]),o.opacityMapTiling=new pc.Vec2(h.scale[0],h.scale[1])),h.hasOwnProperty("offset")&&(o.diffuseMapOffset=new pc.Vec2(h.offset[0],h.offset[1]),o.opacityMapOffset=new pc.Vec2(h.offset[0],h.offset[1]))}}if(o.useMetalness=!0,u.hasOwnProperty("metallicFactor")?o.metalness=u.metallicFactor:o.metalness=1,u.hasOwnProperty("roughnessFactor")?o.shininess=100*u.roughnessFactor:o.shininess=100,u.hasOwnProperty("metallicRoughnessTexture")){var w=u.metallicRoughnessTexture;if(o.metalnessMap=t.textures[w.index],o.metalnessMapChannel="b",o.glossMap=t.textures[w.index],o.glossMapChannel="g",w.hasOwnProperty("texCoord")&&(o.glossMapUv=w.texCoord,o.metalnessMapUv=w.texCoord),w.hasOwnProperty("extensions")&&w.extensions.hasOwnProperty("KHR_texture_transform")){var O=w.extensions.KHR_texture_transform;O.hasOwnProperty("scale")&&(o.glossMapTiling=new pc.Vec2(O.scale[0],O.scale[1]),o.metalnessMapTiling=new pc.Vec2(O.scale[0],O.scale[1])),O.hasOwnProperty("offset")&&(o.glossMapOffset=new pc.Vec2(O.offset[0],O.offset[1]),o.metalnessMapOffset=new pc.Vec2(O.offset[0],O.offset[1]))}}o.chunks.glossPS=e}if(s.hasOwnProperty("normalTexture")){var y=s.normalTexture;if(o.normalMap=t.textures[y.index],y.hasOwnProperty("texCoord")&&(o.normalMapUv=y.texCoord),y.hasOwnProperty("extensions")&&y.extensions.hasOwnProperty("KHR_texture_transform")){var T=y.extensions.KHR_texture_transform;T.hasOwnProperty("scale")&&(o.normalMapTiling=new pc.Vec2(T.scale[0],T.scale[1])),T.hasOwnProperty("offset")&&(o.normalMapOffset=new pc.Vec2(T.offset[0],T.offset[1]))}y.hasOwnProperty("scale")&&(o.bumpiness=y.scale)}if(s.hasOwnProperty("occlusionTexture")){var m=s.occlusionTexture;if(o.aoMap=t.textures[m.index],o.aoMapChannel="r",m.hasOwnProperty("texCoord")&&(o.aoMapUv=m.texCoord),m.hasOwnProperty("extensions")&&m.extensions.hasOwnProperty("KHR_texture_transform")){var E=m.extensions.KHR_texture_transform;E.hasOwnProperty("scale")&&(o.aoMapTiling=new pc.Vec2(E.scale[0],E.scale[1])),E.hasOwnProperty("offset")&&(o.aoMapOffset=new pc.Vec2(E.offset[0],E.offset[1]))}}if(s.hasOwnProperty("emissiveFactor")?(a=s.emissiveFactor,o.emissive.set(Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)),o.emissiveTint=!0):(o.emissive.set(0,0,0),o.emissiveTint=!1),s.hasOwnProperty("emissiveTexture")){var P=s.emissiveTexture;if(o.emissiveMap=t.textures[P.index],P.hasOwnProperty("texCoord")&&(o.emissiveMapUv=P.texCoord),P.hasOwnProperty("extensions")&&P.extensions.hasOwnProperty("KHR_texture_transform")){var M=P.extensions.KHR_texture_transform;M.hasOwnProperty("scale")&&(o.emissiveMapTiling=new pc.Vec2(M.scale[0],M.scale[1])),M.hasOwnProperty("offset")&&(o.emissiveMapOffset=new pc.Vec2(M.offset[0],M.offset[1]))}}if(s.hasOwnProperty("alphaMode"))switch(s.alphaMode){case"MASK":o.blendType=pc.BLEND_NONE,s.hasOwnProperty("alphaCutoff")?o.alphaTest=s.alphaCutoff:o.alphaTest=.5;break;case"BLEND":o.blendType=pc.BLEND_NORMAL;break;default:case"OPAQUE":o.blendType=pc.BLEND_NONE}else o.blendType=pc.BLEND_NONE;return s.hasOwnProperty("doubleSided")?(o.twoSidedLighting=s.doubleSided,o.cull=s.doubleSided?pc.CULLFACE_NONE:pc.CULLFACE_BACK):(o.twoSidedLighting=!1,o.cull=pc.CULLFACE_BACK),s.hasOwnProperty("extras")&&t.processMaterialExtras&&t.processMaterialExtras(o,s.extras),o.update(),o}function translateMesh(e,r){var s=r.gltf,t=[];return e.primitives.forEach(function(e){var a,n,o=e.attributes,i=null,c=null,p=null,f=null,l=null,u=null,d=null,h=null,w=null;if(e.hasOwnProperty("extensions")){var O=e.extensions;if(O.hasOwnProperty("KHR_draco_mesh_compression")){var y=O.KHR_draco_mesh_compression,T=s.bufferViews[y.bufferView],m=r.buffers[T.buffer],E=T.hasOwnProperty("byteOffset")?T.byteOffset:0,P=new Int8Array(m,E,T.byteLength),M=r.decoderModule,A=new M.DecoderBuffer;A.Init(P,P.length);var g,I,v=new M.Decoder,_=v.GetEncodedGeometryType(A);switch(_){case M.INVALID_GEOMETRY_TYPE:console.error("Invalid geometry type");break;case M.POINT_CLOUD:g=new M.PointCloud,I=v.DecodeBufferToPointCloud(A,g);break;case M.TRIANGULAR_MESH:g=new M.Mesh,I=v.DecodeBufferToMesh(A,g)}if(!I.ok()||0==g.ptr){var x=I.error_msg();console.error(x)}var b=g.num_points(),R=g.num_faces();if(y.hasOwnProperty("attributes")){var C=function(e){var r=v.GetAttributeByUniqueId(g,e),s=new M.DracoFloat32Array;v.GetAttributeFloatForAllPoints(g,r,s);var t=b*r.num_components(),n=new Float32Array(t);for(a=0;a<t;a++)n[a]=s.GetValue(a);return M.destroy(s),n},N=y.attributes;N.hasOwnProperty("POSITION")&&(i=C(N.POSITION)),N.hasOwnProperty("NORMAL")&&(c=C(N.NORMAL)),N.hasOwnProperty("TANGENT")&&(p=C(N.TANGENT)),N.hasOwnProperty("TEXCOORD_0")&&(f=C(N.TEXCOORD_0)),N.hasOwnProperty("TEXCOORD_1")&&(l=C(N.TEXCOORD_1)),N.hasOwnProperty("COLOR_0")&&(u=C(N.COLOR_0)),N.hasOwnProperty("JOINTS_0")&&(d=C(N.JOINTS_0)),N.hasOwnProperty("WEIGHTS_0")&&(h=C(N.WEIGHTS_0))}if(_==M.TRIANGULAR_MESH){var S=new M.DracoInt32Array;for(w=b>65535?new Uint32Array(3*R):new Uint16Array(3*R),a=0;a<R;++a)v.GetFaceFromMesh(g,a,S),w[3*a]=S.GetValue(0),w[3*a+1]=S.GetValue(1),w[3*a+2]=S.GetValue(2);M.destroy(S)}M.destroy(g),M.destroy(v),M.destroy(A)}}o.hasOwnProperty("POSITION")&&null===i&&(n=s.accessors[e.attributes.POSITION],i=getAccessorData(s,n,r.buffers)),o.hasOwnProperty("NORMAL")&&null===c&&(n=s.accessors[e.attributes.NORMAL],c=getAccessorData(s,n,r.buffers)),o.hasOwnProperty("TANGENT")&&null===p&&(n=s.accessors[e.attributes.TANGENT],p=getAccessorData(s,n,r.buffers)),o.hasOwnProperty("TEXCOORD_0")&&null===f&&(n=s.accessors[e.attributes.TEXCOORD_0],f=getAccessorData(s,n,r.buffers)),o.hasOwnProperty("TEXCOORD_1")&&null===l&&(n=s.accessors[e.attributes.TEXCOORD_1],l=getAccessorData(s,n,r.buffers)),o.hasOwnProperty("COLOR_0")&&null===u&&(n=s.accessors[e.attributes.COLOR_0],u=getAccessorData(s,n,r.buffers)),o.hasOwnProperty("JOINTS_0")&&null===d&&(n=s.accessors[e.attributes.JOINTS_0],d=getAccessorData(s,n,r.buffers)),o.hasOwnProperty("WEIGHTS_0")&&null===h&&(n=s.accessors[e.attributes.WEIGHTS_0],h=getAccessorData(s,n,r.buffers)),e.hasOwnProperty("indices")&&null===w&&(n=s.accessors[e.indices],w=getAccessorData(s,n,r.buffers));var L=i.length/3;null!==i&&null===c&&(c=pc.calculateNormals(i,null===w?function(){var e=new Uint16Array(L);for(a=0;a<L;a++)e[a]=a;return e}():w));var U=[];i&&U.push({semantic:pc.SEMANTIC_POSITION,components:3,type:pc.TYPE_FLOAT32}),c&&U.push({semantic:pc.SEMANTIC_NORMAL,components:3,type:pc.TYPE_FLOAT32}),p&&U.push({semantic:pc.SEMANTIC_TANGENT,components:4,type:pc.TYPE_FLOAT32}),f&&U.push({semantic:pc.SEMANTIC_TEXCOORD0,components:2,type:pc.TYPE_FLOAT32}),l&&U.push({semantic:pc.SEMANTIC_TEXCOORD1,components:2,type:pc.TYPE_FLOAT32}),u&&U.push({semantic:pc.SEMANTIC_COLOR,components:4,type:pc.TYPE_UINT8,normalize:!0}),d&&U.push({semantic:pc.SEMANTIC_BLENDINDICES,components:4,type:pc.TYPE_UINT8}),h&&U.push({semantic:pc.SEMANTIC_BLENDWEIGHT,components:4,type:pc.TYPE_FLOAT32});var D,V,F,G,k,B=new pc.VertexFormat(r.device,U),H=new pc.VertexBuffer(r.device,B,L,pc.BUFFER_STATIC),K=H.lock(),X=new Float32Array(K),Y=new Uint8Array(K),W=function(e){var r=B.elements;for(a=0;a<r.length;a++)if(r[a].name===e)return r[a];return null};if(null!==i)for(G=(F=W(pc.SEMANTIC_POSITION)).offset/4,k=F.stride/4,a=0;a<L;a++)V=3*a,X[D=G+a*k]=i[V],X[D+1]=i[V+1],X[D+2]=i[V+2];if(null!==c)for(G=(F=W(pc.SEMANTIC_NORMAL)).offset/4,k=F.stride/4,a=0;a<L;a++)V=3*a,X[D=G+a*k]=c[V],X[D+1]=c[V+1],X[D+2]=c[V+2];if(null!==p)for(G=(F=W(pc.SEMANTIC_TANGENT)).offset/4,k=F.stride/4,a=0;a<L;a++)V=4*a,X[D=G+a*k]=p[V],X[D+1]=p[V+1],X[D+2]=p[V+2],X[D+3]=p[V+3];if(null!==f)for(G=(F=W(pc.SEMANTIC_TEXCOORD0)).offset/4,k=F.stride/4,a=0;a<L;a++)V=2*a,X[D=G+a*k]=f[V],X[D+1]=f[V+1];if(null!==l)for(G=(F=W(pc.SEMANTIC_TEXCOORD1)).offset/4,k=F.stride/4,a=0;a<L;a++)V=2*a,X[D=G+a*k]=l[V],X[D+1]=l[V+1];if(null!==u)for(G=(F=W(pc.SEMANTIC_COLOR)).offset,k=F.stride,n=s.accessors[e.attributes.COLOR_0],a=0;a<L;a++){D=G+a*k;var $=u[V="VEC4"===n.type?4*a:3*a],Q=u[V+1],j=u[V+2],J=u[V+3];Y[D]=Math.round(255*pc.math.clamp($,0,1)),Y[D+1]=Math.round(255*pc.math.clamp(Q,0,1)),Y[D+2]=Math.round(255*pc.math.clamp(j,0,1)),Y[D+3]="VEC4"===n.type?Math.round(255*pc.math.clamp(J,0,1)):255}if(null!==d)for(G=(F=W(pc.SEMANTIC_BLENDINDICES)).offset,k=F.stride,a=0;a<L;a++)V=4*a,Y[D=G+a*k]=d[V],Y[D+1]=d[V+1],Y[D+2]=d[V+2],Y[D+3]=d[V+3];if(null!==h)for(G=(F=W(pc.SEMANTIC_BLENDWEIGHT)).offset/4,k=F.stride/4,a=0;a<L;a++)V=4*a,X[D=G+a*k]=h[V],X[D+1]=h[V+1],X[D+2]=h[V+2],X[D+3]=h[V+3];H.unlock();var q=new pc.Mesh;if(q.vertexBuffer=H,q.primitive[0].type=function getPrimitiveType(e){var r=pc.PRIMITIVE_TRIANGLES;if(e.hasOwnProperty("mode"))switch(e.mode){case 0:r=pc.PRIMITIVE_POINTS;break;case 1:r=pc.PRIMITIVE_LINES;break;case 2:r=pc.PRIMITIVE_LINELOOP;break;case 3:r=pc.PRIMITIVE_LINESTRIP;break;case 4:r=pc.PRIMITIVE_TRIANGLES;break;case 5:r=pc.PRIMITIVE_TRISTRIP;break;case 6:r=pc.PRIMITIVE_TRIFAN}return r}(e),q.primitive[0].base=0,q.primitive[0].indexed=null!==w,null!==w){var z;z=w instanceof Uint8Array?pc.INDEXFORMAT_UINT8:w instanceof Uint16Array?pc.INDEXFORMAT_UINT16:pc.INDEXFORMAT_UINT32;var Z=w.length,ee=new pc.IndexBuffer(r.device,z,Z,pc.BUFFER_STATIC,w);q.indexBuffer[0]=ee,q.primitive[0].count=w.length}else q.primitive[0].count=L;q.materialIndex=e.material;var re=(n=s.accessors[e.attributes.POSITION]).min,se=n.max,te=new pc.BoundingBox(new pc.Vec3((se[0]+re[0])/2,(se[1]+re[1])/2,(se[2]+re[2])/2),new pc.Vec3((se[0]-re[0])/2,(se[1]-re[1])/2,(se[2]-re[2])/2));if(q.aabb=te,e.hasOwnProperty("targets")){var ae=[];e.targets.forEach(function(e){var t={};e.hasOwnProperty("POSITION")&&(n=s.accessors[e.POSITION],t.deltaPositions=getAccessorData(s,n,r.buffers)),e.hasOwnProperty("NORMAL")&&(n=s.accessors[e.NORMAL],t.deltaNormals=getAccessorData(s,n,r.buffers)),e.hasOwnProperty("TANGENT")&&(n=s.accessors[e.TANGENT],t.deltaTangents=getAccessorData(s,n,r.buffers)),ae.push(new pc.MorphTarget(t))}),q.morph=new pc.Morph(ae)}t.push(q)}),t}var s=new pc.Mat4,t=new pc.Vec3;function translateNode(e,r){var a=new pc.GraphNode;if(e.hasOwnProperty("name")?a.name=e.name:a.name="Node "+r.nodeCounter,e.hasOwnProperty("matrix")&&(s.data.set(e.matrix),s.getTranslation(t),a.setLocalPosition(t),s.getEulerAngles(t),a.setLocalEulerAngles(t),s.getScale(t),a.setLocalScale(t)),e.hasOwnProperty("rotation")){var n=e.rotation;a.setLocalRotation(n[0],n[1],n[2],n[3])}if(e.hasOwnProperty("translation")){var o=e.translation;a.setLocalPosition(o[0],o[1],o[2])}if(e.hasOwnProperty("scale")){var i=e.scale;a.setLocalScale(i[0],i[1],i[2])}return r.nodeCounter++,a}function translateSkin(e,r){var s,t,a,n=r.gltf,o=e.joints,i=o.length,c=[];if(e.hasOwnProperty("inverseBindMatrices")){var p=e.inverseBindMatrices,f=getAccessorData(n,n.accessors[p],r.buffers),l=[];for(s=0;s<i;s++){for(t=0;t<16;t++)l[t]=f[16*s+t];(a=new pc.Mat4).set(l),c.push(a)}}else for(s=0;s<i;s++)a=new pc.Mat4,c.push(a);var u=[];for(s=0;s<i;s++)u[s]=r.nodes[o[s]].name;var d=e.skeleton,h=new pc.Skin(r.device,c,u);for(h.skeleton=r.nodes[d],h.bones=[],s=0;s<o.length;s++)h.bones[s]=r.nodes[o[s]];return h}function translateTexture(e,r){var s=new pc.Texture(r.device,{flipY:!1});if(e.hasOwnProperty("name")&&(s.name=e.name),e.hasOwnProperty("sampler")){var t=r.gltf.samplers[e.sampler];t.hasOwnProperty("minFilter")&&(s.minFilter=getFilter(t.minFilter)),t.hasOwnProperty("magFilter")&&(s.magFilter=getFilter(t.magFilter)),t.hasOwnProperty("wrapS")&&(s.addressU=getWrap(t.wrapS)),t.hasOwnProperty("wrapT")&&(s.addressV=getWrap(t.wrapT))}return s}function parse(e,r,s,t){if(t){if(!s.gltf.hasOwnProperty(e))return void t();if(0===s.gltf[e].length)return void t()}s.gltf.hasOwnProperty(e)&&(s[e]=s.gltf[e].map(function(e){return r(e,s,t)}))}function loadGltf(e,r,s,t){var a=t&&t.hasOwnProperty("buffers")?t.buffers:void 0,n=t&&t.hasOwnProperty("basePath")?t.basePath:void 0,o=t&&t.hasOwnProperty("processUri")?t.processUri:void 0,i=t&&t.hasOwnProperty("processAnimationExtras")?t.processAnimationExtras:void 0,c=t&&t.hasOwnProperty("processMaterialExtras")?t.processMaterialExtras:void 0,p=t&&t.hasOwnProperty("processGlobalExtras")?t.processGlobalExtras:void 0,f={basePath:n,buffers:a,device:r,defaultMaterial:translateMaterial({}),gltf:e,imagesLoaded:0,nodeCounter:0,processUri:o,processAnimationExtras:i,processMaterialExtras:c};e.hasOwnProperty("extensionsUsed")&&-1!==e.extensionsUsed.indexOf("KHR_draco_mesh_compression")&&(f.decoderModule=t.decoderModule),function loadBuffers(e,r){if(e.buffers)r();else{var s=e.gltf;if(e.buffers=[],s.hasOwnProperty("buffers")){var t=0;s.buffers.forEach(function(a,n){if(a.hasOwnProperty("uri"))if(isDataURI(a.uri)){var o=atob(a.uri.split(",")[1]);e.buffers[n]=new ArrayBuffer(o.length);for(var i=new Uint8Array(e.buffers[n]),c=0;c<o.length;c++)i[c]=o.charCodeAt(c);s.buffers.length===++t&&r()}else if(e.processUri)e.processUri(a.uri,function(a){e.buffers[n]=a,s.buffers.length===++t&&r()});else{var p=new XMLHttpRequest;p.open("GET",e.basePath+a.uri,!0),p.responseType="arraybuffer",p.onload=function(a){e.buffers[n]=this.response,s.buffers.length===++t&&r()},p.send()}})}}}(f,function(){parse("textures",translateTexture,f),parse("images",translateImage,f,function(){parse("materials",translateMaterial,f),parse("meshes",translateMesh,f),parse("nodes",translateNode,f),parse("skins",translateSkin,f),parse("animations",translateAnimation,f),e.hasOwnProperty("extras")&&p&&p(e.extras),function buildHierarchy(e){e.gltf.nodes.forEach(function(r,s){r.hasOwnProperty("children")&&r.children.forEach(function(r){var t=e.nodes[r];t.parent&&t.parent.removeChild(t),e.nodes[s].addChild(t)})})}(f),s(null,{model:function createModel(e){var r=e.gltf,s=[],t=[],a=[];r.nodes.forEach(function(r,n){r.hasOwnProperty("mesh")&&e.meshes[r.mesh].forEach(function(o){var i;i=void 0===o.materialIndex?e.defaultMaterial:e.materials[o.materialIndex];var c=new pc.MeshInstance(e.nodes[n],o,i);if(s.push(c),o.morph){var p=new pc.MorphInstance(o.morph);c.morphInstance=p,p.updateBounds(c.mesh),o.weights&&o.weights.forEach(function(e,r){p.setWeight(r,e)}),a.push(p)}if(r.hasOwnProperty("skin")){var f=e.skins[r.skin];o.skin=f;var l=new pc.SkinInstance(f);l.bones=f.bones,c.skinInstance=l,t.push(l)}})});var n=new pc.Model,o=function getRoots(e){var r=e.gltf,s=[];if(r.hasOwnProperty("scenes")){var t=0;r.hasOwnProperty("scene")&&(t=r.scene);for(var a=r.scenes[t].nodes,n=0;n<a.length;n++)s.push(e.nodes[a[n]])}else s.push(e.nodes[0]);return s}(e);return 1===o.length?n.graph=o[0]:(n.graph=new pc.GraphNode,o.forEach(function(e){n.graph.addChild(e)})),n.meshInstances=s,n.morphInstances=a,n.skinInstances=t,n}(f),textures:f.textures,animations:f.animations}),e.hasOwnProperty("extensionsUsed")&&-1!==e.extensionsUsed.indexOf("KHR_draco_mesh_compression")&&(f.decoderModule=null)})})}return{loadGltf:loadGltf,loadGlb:function loadGlb(e,r,s,t){var a=new DataView(e),n=a.getUint32(0,!0);if(1179937895===n){var o=a.getUint32(4,!0);if(2===o){var i=a.getUint32(8,!0),c=a.getUint32(12,!0),p=a.getUint32(16,!0);if(1313821514===p){var f=new Uint8Array(e,20,c),l=JSON.parse(function decodeBinaryUtf8(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var r="",s=0,t=e.length;s<t;s++)r+=String.fromCharCode(e[s]);return decodeURIComponent(escape(r))}(f));console.log(l),console.log(l.accessors,"accessor",l.accessors.length);for(var u=[],d=20+c;d<i;){if(c=a.getUint32(d,!0),5130562!==(p=a.getUint32(d+4,!0)))return void s("Invalid chunk type found in glb file. Expected 0x004E4942, found 0x"+p.toString(16));var h=e.slice(d+8,d+8+c);u.push(h),d+=c+8}(t=t||{}).buffers=u,loadGltf(l,r,s,t)}else s("Invalid chunk type found in glb file. Expected 0x4E4F534A, found 0x"+p.toString(16))}else s("Invalid version number found in glb header. Expected 2, found "+o)}else s("Invalid magic number found in glb header. Expected 0x46546C67, found 0x"+n.toString(16))}}}());// toon.js
/*jshint esversion: 6, asi: true, laxbreak: true*/
const Toon = pc.createScript('toon');
Toon.attributes.add('edgeSize', { type: 'number', default: 0.005 });
Toon.attributes.add('edgeColor', { type: 'rgba', default:[0,0,0,1] });
Toon.attributes.add("transformToonEdgeVS", {type: "asset"})
Toon.attributes.add("transformToonEdgeSkinnedVS", {type: "asset"})
Toon.attributes.add("lightDiffuseToonPS", {type: "asset"})
Toon.attributes.add("edgeToonPS", {type: "asset"})
Toon.attributes.add("number", {type: "number"})
Toon.attributes.add("isOutline", {type: "boolean", default: true})


Toon.prototype.initialize = function() {
    this.app.on(`loaded:model:${this.number}`, () => {
    const transformToonEdgeVS = this.transformToonEdgeVS.resource;
    const transformToonEdgeSkinnedVS = this.transformToonEdgeSkinnedVS.resource;
    const lightDiffuseToonPS = this.lightDiffuseToonPS.resource;
    const edgePS = this.edgeToonPS.resource;
    const meshes = this.entity.model.model.meshInstances;
    const edgeMeshes = [];
    
    for(let mesh of meshes) {
        const mat = mesh.material;
        mat.emissiveMap = mat.diffuseMap
        mat.emissive = mat.diffuse
        mat.update();
        
        const edgeMat = mat.clone();
        edgeMat.chunks.transformVS = transformToonEdgeVS;
        edgeMat.chunks.transformSkinnedVS = transformToonEdgeSkinnedVS;
        edgeMat.customFragmentShader = edgePS;
        edgeMat.cull = pc.CULLFACE_FRONT;
        edgeMat.update();
        
        const edgeMesh = new pc.MeshInstance(mesh.node, mesh.mesh, edgeMat);

        if(this.isOutline){
                   edgeMesh.castShadow = true;
        edgeMesh.receiveShadow = true;
        edgeMesh.castShadowsLightmap = true

        edgeMesh.skinInstance = mesh.skinInstance; 
       
        edgeMesh.setParameter("edgeColor", this.edgeColor.data);
        edgeMesh.updateKey();
        edgeMeshes.push(edgeMesh);
            
             }
    }
    this.app.scene.removeModel(this.entity.model.model);
    this.entity.model.model.meshInstances = meshes.concat(edgeMeshes);
    this.app.scene.addModel(this.entity.model.model);
    }, null)
};



// change-model-button.js
var ChangeModelButton = pc.createScript('changeModelButton');
ChangeModelButton.attributes.add("interval", {type: "number", default: 0})
// initialize code called once per entity
ChangeModelButton.prototype.initialize = function() {
    //　タッチできる端末だったら
    if(this.app.touch){
         // element componentがタッチされたらattributes: messageアラートとして表示する
        this.entity.element.on(pc.EVENT_TOUCHSTART, () => this.changeModel())
    }else{
         // element componentがクリックされたらattributes: messageアラートとして表示する
        this.entity.element.on("click", () => this.changeModel())
    }

};

ChangeModelButton.prototype.changeModel = function(){
    this.app.fire("game:model:change", this.interval);
}

// changeText.js
var ChangeText = pc.createScript('changeText');

ChangeText.prototype.initialize = function() {
    this.app.on("game:text:change", (text) => {
        this.entity.element.text = text
    })
};


